---
- name: mkdir ~/drivers_ENVs
  file: path={{ home }}/drivers_ENVs state=directory

- name: extract the drivers names
  shell: >
      {{ app }}/config.sh | jq --raw-output '.loaded_drivers|.[]'
  register: driver_names

- name: create and update the drivers virtualenvs
  pip: virtualenv={{ home }}/drivers_ENVs/{{ item }} name=pip state=latest
  with_items: driver_names.stdout_lines
- name: install drivers requirements.txt
  pip: virtualenv={{ home }}/drivers_ENVs/{{ item }}
      requirements={{ drivers }}/drivers/{{ item }}/requirements.txt
      extra_args="--use-wheel --find-links={{ drivers }}/wheelhouse"
  with_items: driver_names.stdout_lines
  ignore_errors: True

# TODO: delete the virtualenvs not in use
